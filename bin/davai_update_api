#!/usr/bin/env python3
# -*- coding:Utf-8 -*-
"""
Update Davai API.
"""
from __future__ import print_function, absolute_import, unicode_literals, division

import os
import subprocess
import argparse
import sys

# Automatically set the python path
package_path = os.path.dirname(os.path.dirname(os.path.realpath(__file__)))
sys.path.insert(0, package_path)
from davai_api.api import this_repo


def main(local_repo=this_repo):
    os.chdir(local_repo)
    print("In '{}':".format(local_repo))
    subprocess.check_call(['git', 'fetch'])
    # so that in case of detached HEAD, it will be updated too at the next use:
    subprocess.check_call(['git', 'checkout', 'master'])
    subprocess.check_call(['git', 'pull', 'origin', 'master', '--ff-only'])


if __name__ == '__main__':
    parser = argparse.ArgumentParser(description="Update Davai API.")
    parser.add_argument('-r', '--local_repository',
                        help="local repository to update; defaults to '{}'".format(this_repo),
                        default=this_repo)
    args = parser.parse_args()

    main(args.local_repository)

